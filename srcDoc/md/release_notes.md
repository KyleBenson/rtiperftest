# Release Notes

## RTI Perftest 2.0 Compatibility

*RTI Perftest* 2.0 is designed to compile and work against the *RTI Connext DDS* 5.2.x releases.

However, certain features are not compatible with all the *RTI Connext DDS* versions, since the build scripts make use of certain specific parameters in *Rtiddsgen* that might change or not be present between releases:

- The `--secure` and `--openssl-home` parameters will not work for versions previous to *RTI Connext DDS* 5.2.5.
- The C# code generation against *RTI Connext DDS 5.2.0.x* is not supported. Users can disable its compilation by adding the `--skip-cs-build` flag.

## What's New in 2.1

### Multicast Periodic Heartbeats when the `-multicast` Command-Line Parameter is present

In previous releases, the Writer side sent heartbeats via unicast even if the Command-Line Parameter `-multicast` was present. Now heartbeats will be sent via multicast when `-multicast` is used. This change should not affect one-to-one scenarios, but it will reduce the number of heartbeats the Publisher side has to send in scenarios with multiple subscribers.

### Added Command-Line Parameter to get the *Pulled Sample Count* in the Publisher side

The `-writerStats` Command-Line Parameter now enables the some extra debug log messages shown in the *Publisher* side of *RTI Perftest*. These messages will contain the total number of samples being "pulled" by the *Subscriber* side.

### Added extra logic to be able to support *RTI Connext DDS 5.2.7* on Windows

The names of the solutions generated by *rtiddsgen* for Windows architectures changed in Code Generator 3.2.6 (included with *RTI Connext DDS 5.2.7*). The solution name now includes the *rtiddsgen* version number. Therefore the *RTIPerftest*'s `build.bat` script now must query the *rtiddsgen* version and adjust the name of the generated solutions it needs to call to compile.

This change should not be noticed by the user, as the script will automatically handle the task of determining the version of *rtiddsgen*.

### Added Command-Line Parameter to avoid loading QoS from xml in C++.

If the `-noXmlQos` option is provided to *RTI Perftest* it will not try to load the QoS from the `xml` file, instead it will load the QoS from a string provided in the code. This string contains the same values the `xml` file provides.

This option is only present for the Modern and Traditional C++ PSM API code.

Note that changes in the `xml` will be ignored if this option is present.

### Updated Secure Certificates, Governance and Permission Files

Governance and Permission files have been updated to be compatible with the latest release for *RTI Connext DDS*, and are compatible with *RTI Connext DDS* 5.2.7 and greater.

If you are compiling *RTI Perftest* against 5.2.5, you will need to get the certificates from the `release/2.0` branch. You can do that by using the following git command from the top level directory of your repository:

```
git checkout release/2.0 -- resource/secure
```

## What's Fixed in Master

### Batching is disabled when the size of the sample is equal or greater than the Batch size

In previous releases the Batching Parameters were set unconditionally, now the Batching QoS will be only applied if the Batch size is strictly greater than the sample size.

### Changed name of the "-enableTcp" option

In previous releases the command-line option to use TCP for the communication was named as `-enableTcpOnly`. This is was inconsistent with other transport options, so the name of the command has been modified to `-enableTcp`.

### Added Command-Line Parameter  "-asynchronous" and "-flowController `<`flow`>`"

In previous releases Asynchronous Publishing was only enabled for the DataWriters when the samples are greater than 63000 Bytes and in such chase, RTI Perftest would only use a custom flow controller defined for 1Gbps Networks.

This behavior has been modified: Starting from this release, Asynchronous Publishing will be activated if the samples to send are bigger than 63000 Bytes or if the `-asynchronous` Command-Line Parameter is used. In that case, RTI Perftest will use the `Default` flow controller, however this behavior now can be changed by specifying the `-flowController` option, which allows to specify if using the default flow controller, a 1Gbps flow controller or a 10Gbps one.

### Improved "-pubRate" Command-Line Parameter capabilities

In previous relesases the "-pubRate" command-line option would only use the `spin` function to control the publication rate, that could have negative effects related with high CPU consumption for certain scenarios. Starting from this release, a new modifier has been added to this option so it is possible to use the both "spin" and "sleep" as a way to control the publication rate.

### Add command line option to get the CPU consumption of the process

Starting in this release, it is possible to display the *CPU consumption* of the *RTI Perftest* process by adding the Command-Line Parameter `-cpu` using a Monitor.

### Support Large Data samples

Prior to this release, the maximum sample size allowed by *RTI Perftest* was set to 131072 Bytes. The use of bigger sizes would imply changes in the `perftest.idl` file and source code files.
Starting from this release, the maximum data length that *RTI Perftest* allows has increased to 2,147,483,135 Bytes, which corresponds to 2 GBytes - 512 Bytes - 8 Bytes, the maximum data length that *RTI Connext DDS* can send.

The sample size can be set via the `-dataLen <bytes>` Command-Line Parameter, if such value is larger than 63,000 Bytes *RTI Perftest* will enable the use of *Asynchronous Publishing* and *Unbounded Sequences*.

It is also possible to enable the use of *Unbounded Sequences* or *Asynchronous Publishing* independently of the sample size by specifying the Command-Line Parameters `unbounded <managerMemory>` and `-asynchronous`.

## What's Fixed in 2.1

### "--nddshome" Command-Line Option did not Work in `build.bat` Script -- Windows Systems Only

There was an error in the `build.sh` script logic when checking for the existence of the compiler executable files. This problem has been resolved.

### `build.sh` script did not make sure executable existed before starting compilation

Part of the `build.sh` script logic to check the existence of the compiler executable files was not being called properly. This issue is now fixed.

### Incorrect `high_watermark` value when `sendQueueSize` is set to 1

Setting the command-line parameter `-sendQueueSize` to 1 caused *RTI Perftest* to fail, since it mistakenly set the `high_watermark` value equal to the `low_watermark`. This problem has been resolved. Now the `high_watermark` is always greater than the `low_watermark`.

### Batching settings not correctly set in the `C++03` code

Settings related to batching in the XML configuration (`perftest_qos_profiles.xml`) were not being used. This problem has been resolved.

### `dds.transport.shmem.builtin.received_message_count_max` incorrectly set in Java code

The `dds.transport.shmem.builtin.received_message_count_max` property was incorrectly set to 1 in every case. This erroneous behavior, which was introduced in *RTI Perftest 2.0*, has been resolved.

### Command-Line Parameter for setting the *RTI Connext DDS* verbosity

In previous releases of RTI Perftest, the RTI Connext DDS verbosity could only be modified by using the command-line parameter `-debug`. This parameter would set the verbosity to `STATUS_ALL`, with no option to select an intermediate verbosity.

This behavior has been modified. The command-line parameter `-debug` has been changed to `-verbosity,` which can be followed by one of the verbosity levels (Silent, Error, Warning, or All).

The default verbosity is Error.

## What's New in 2.0

### Platform support and build system

*RTI Perftest 2.0* makes use of the *RTI Connext DDS* *Rtiddsgen* tool in order to generate part of its code and also the makefile/project files used to compile that code.

Therefore, all the already generated makefiles and *Visual Studio* solutions have been removed and now the build system depends on 2 scripts: `build.sh` for Unix-based systems and `build.bat` for Windows systems.

*RTI Perftest* scripts works for every platform for which *Rtiddsgen* can generate an example, except for those in which *Rtiddsgen* doesn't generate regular makefiles or *Visual Studio Solutions* but specific project files. That is the case of *Android* platforms as well as the *iOS* ones.

Certain platforms will compile with the out of-the-box code and configurations, but further tuning could be needed in order to make the application run in the specific platform. The reason is usually the memory consumption of the application or the lack of support of the platform for certain features (like a file system).

### Improved directory structure

*RTI Perftest 2.0* directory structure has been cleaned up, having now a much more compact and consistent schema.

### Github

*RTI Perftest* development has been moved to a *GitHub* project. This will allow more frequently updates and code contributions.

The URL of the project is the following: [github.com/rticommunity/rtiperftest](github.com/rticommunity/rtiperftest).

### Numeration schema

*RTI Perftest* development and releases are now decoupled from *RTI Connext DDS* ones, therefore, and to avoid future numeration conflicts, *RTI Perftest* moved to a different numeration schema.

The compatibility between *RTI Perftest* versions and *RTI Connext DDS* ones will be clearly stated in the release notes of every *RTI Perftest* release, as well as in the top level `README.md` file.

### Documentation

Documentation is no longer provided as a PDF document, but as *markdown* files as well as in *html* format. You will be able to access to the documentation from the *RTI Community* page, as well as from the *GitHub* project.

### Support for UDPv6

Added Command-Line Parameter to force communication via UDPv6. By specifying `-enableUdpv6` you will only communicate data by using the UDPv6 transport.

The use of this feature will imply setting the `NDDS_DISCOVERY_PEERS` environment variable to (at least) one valid IPv6 address.

### Support for Dynamic data

Added Command-Line Parameter to specify the use of the Dynamic Data API instead of the regular *Rtiddsgen* generated code use.

### Simplified execution in VxWorks kernel mode

The execution in *VxWorks OS kernel mode* has been simplified for the user. Now the user can make use of `subscriber_main()` and `publisher_main()` and modify its content with all the parameters required for the tests.

### Decreased Memory Requirements for Latency Performance Test

The default number of iterations (samples sent by the performance test publisher side) when performing a latency test has been updated. Before, the default value was `100,000,000`. This value was used to internally allocate certain buffers, which imposed large memory requirements. The new value is `10,000,000` (10 times less).

## What's Fixed in 2.0

### RTI Perftest behavior when using multiple publishers

The previous behavior specified that an *RTI Perftest Subscriber* in a scenario with multiple *RTI Perftest Publishers* would stop receiving samples and exit after receiving the last sample from the *RTI Perftest* Publisher with `pid=0`. This behavior could lead into an hang state if some *RTI Perftest Publishers* with different `pid` were still missing to send new samples. 

The new behavior makes the *RTI Perftest Subscriber* wait until all the Perftest Publishers finish sending all their samples and then exit.

### Possible `std::bad_alloc` and Segmentation Fault in Latency Test in case of insufficient memory

When performing a latency performance test with traditional or modern C++, the test tries to allocate certain arrays of unsigned longs. These arrays can be quite large. On certain embedded platforms, due to memory limitations, this caused a `std::bad_alloc` error that was not properly captured, and a segmentation fault. This problem has been resolved. Now the performance test will inform you of the memory allocation issue and exit properly.

### Default Max Number of Instances on Subscriber Side Changed to `DDS_LENGTH_UNLIMITED`

In the previous release, if you did not set the maximum number of instances on the subscriber side, it would default to one instance. Therefore the samples for all instances except the first one were lost.

The new default maximum number of instances on the subscriber side has been changed from one to `DDS_LENGTH_UNLIMITED`. You can change this limit manually by setting the Parameter `-instances <number>`.

### Error when using Shared Memory and Large Samples

When using *RTI Perftest* with large samples and enabling shared memory we could get into the following error:

```
Large data settings enabled (-dataLen > 63000).
[D0001|ENABLE]NDDS_Transport_Shmem_Property_verify:received_message_count_max < 1
[D0001|ENABLE]NDDS_Transport_Shmem_newI:Invalid transport properties.
```

## Known Issues

### Compiling manually on Windows when using the *RTI Security* plugin

*rtiddsgen* generated solutions for Windows allow 4 different configurations: 

* Debug
* Debug DLL
* Release
* Release DLL

However, *RTI Perftest 2.0* new build system is focused to only compile one of those modes at a time. Choosing the compilation mode should be done via the `-debug` and `-dynamic` flags.
